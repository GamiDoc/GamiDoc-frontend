{"ast":null,"code":"var inherits = require('inherits');\n\nvar EventEmitter = require('events').EventEmitter;\n\nmodule.exports = Queue;\nmodule.exports.default = Queue;\n\nfunction Queue(options) {\n  if (!(this instanceof Queue)) {\n    return new Queue(options);\n  }\n\n  EventEmitter.call(this);\n  options = options || {};\n  this.concurrency = options.concurrency || Infinity;\n  this.timeout = options.timeout || 0;\n  this.autostart = options.autostart || false;\n  this.results = options.results || null;\n  this.pending = 0;\n  this.session = 0;\n  this.running = false;\n  this.jobs = [];\n  this.timers = {};\n}\n\ninherits(Queue, EventEmitter);\nvar arrayMethods = ['pop', 'shift', 'indexOf', 'lastIndexOf'];\narrayMethods.forEach(function (method) {\n  Queue.prototype[method] = function () {\n    return Array.prototype[method].apply(this.jobs, arguments);\n  };\n});\n\nQueue.prototype.slice = function (begin, end) {\n  this.jobs = this.jobs.slice(begin, end);\n  return this;\n};\n\nQueue.prototype.reverse = function () {\n  this.jobs.reverse();\n  return this;\n};\n\nvar arrayAddMethods = ['push', 'unshift', 'splice'];\narrayAddMethods.forEach(function (method) {\n  Queue.prototype[method] = function () {\n    var methodResult = Array.prototype[method].apply(this.jobs, arguments);\n\n    if (this.autostart) {\n      this.start();\n    }\n\n    return methodResult;\n  };\n});\nObject.defineProperty(Queue.prototype, 'length', {\n  get: function () {\n    return this.pending + this.jobs.length;\n  }\n});\n\nQueue.prototype.start = function (cb) {\n  if (cb) {\n    callOnErrorOrEnd.call(this, cb);\n  }\n\n  this.running = true;\n\n  if (this.pending >= this.concurrency) {\n    return;\n  }\n\n  if (this.jobs.length === 0) {\n    if (this.pending === 0) {\n      done.call(this);\n    }\n\n    return;\n  }\n\n  var self = this;\n  var job = this.jobs.shift();\n  var once = true;\n  var session = this.session;\n  var timeoutId = null;\n  var didTimeout = false;\n  var resultIndex = null;\n  var timeout = job.hasOwnProperty('timeout') ? job.timeout : this.timeout;\n\n  function next(err, result) {\n    if (once && self.session === session) {\n      once = false;\n      self.pending--;\n\n      if (timeoutId !== null) {\n        delete self.timers[timeoutId];\n        clearTimeout(timeoutId);\n      }\n\n      if (err) {\n        self.emit('error', err, job);\n      } else if (didTimeout === false) {\n        if (resultIndex !== null) {\n          self.results[resultIndex] = Array.prototype.slice.call(arguments, 1);\n        }\n\n        self.emit('success', result, job);\n      }\n\n      if (self.session === session) {\n        if (self.pending === 0 && self.jobs.length === 0) {\n          done.call(self);\n        } else if (self.running) {\n          self.start();\n        }\n      }\n    }\n  }\n\n  if (timeout) {\n    timeoutId = setTimeout(function () {\n      didTimeout = true;\n\n      if (self.listeners('timeout').length > 0) {\n        self.emit('timeout', next, job);\n      } else {\n        next();\n      }\n    }, timeout);\n    this.timers[timeoutId] = timeoutId;\n  }\n\n  if (this.results) {\n    resultIndex = this.results.length;\n    this.results[resultIndex] = null;\n  }\n\n  this.pending++;\n  self.emit('start', job);\n  var promise = job(next);\n\n  if (promise && promise.then && typeof promise.then === 'function') {\n    promise.then(function (result) {\n      return next(null, result);\n    }).catch(function (err) {\n      return next(err || true);\n    });\n  }\n\n  if (this.running && this.jobs.length > 0) {\n    this.start();\n  }\n};\n\nQueue.prototype.stop = function () {\n  this.running = false;\n};\n\nQueue.prototype.end = function (err) {\n  clearTimers.call(this);\n  this.jobs.length = 0;\n  this.pending = 0;\n  done.call(this, err);\n};\n\nfunction clearTimers() {\n  for (var key in this.timers) {\n    var timeoutId = this.timers[key];\n    delete this.timers[key];\n    clearTimeout(timeoutId);\n  }\n}\n\nfunction callOnErrorOrEnd(cb) {\n  var self = this;\n  this.on('error', onerror);\n  this.on('end', onend);\n\n  function onerror(err) {\n    self.end(err);\n  }\n\n  function onend(err) {\n    self.removeListener('error', onerror);\n    self.removeListener('end', onend);\n    cb(err, this.results);\n  }\n}\n\nfunction done(err) {\n  this.session++;\n  this.running = false;\n  this.emit('end', err);\n}","map":{"version":3,"names":["inherits","require","EventEmitter","module","exports","Queue","default","options","call","concurrency","Infinity","timeout","autostart","results","pending","session","running","jobs","timers","arrayMethods","forEach","method","prototype","Array","apply","arguments","slice","begin","end","reverse","arrayAddMethods","methodResult","start","Object","defineProperty","get","length","cb","callOnErrorOrEnd","done","self","job","shift","once","timeoutId","didTimeout","resultIndex","hasOwnProperty","next","err","result","clearTimeout","emit","setTimeout","listeners","promise","then","catch","stop","clearTimers","key","on","onerror","onend","removeListener"],"sources":["/home/carlobottaro/Documents/UniversitÃ /gamification/node_modules/queue/index.js"],"sourcesContent":["var inherits = require('inherits')\nvar EventEmitter = require('events').EventEmitter\n\nmodule.exports = Queue\nmodule.exports.default = Queue\n\nfunction Queue (options) {\n  if (!(this instanceof Queue)) {\n    return new Queue(options)\n  }\n\n  EventEmitter.call(this)\n  options = options || {}\n  this.concurrency = options.concurrency || Infinity\n  this.timeout = options.timeout || 0\n  this.autostart = options.autostart || false\n  this.results = options.results || null\n  this.pending = 0\n  this.session = 0\n  this.running = false\n  this.jobs = []\n  this.timers = {}\n}\ninherits(Queue, EventEmitter)\n\nvar arrayMethods = [\n  'pop',\n  'shift',\n  'indexOf',\n  'lastIndexOf'\n]\n\narrayMethods.forEach(function (method) {\n  Queue.prototype[method] = function () {\n    return Array.prototype[method].apply(this.jobs, arguments)\n  }\n})\n\nQueue.prototype.slice = function (begin, end) {\n  this.jobs = this.jobs.slice(begin, end)\n  return this\n}\n\nQueue.prototype.reverse = function () {\n  this.jobs.reverse()\n  return this\n}\n\nvar arrayAddMethods = [\n  'push',\n  'unshift',\n  'splice'\n]\n\narrayAddMethods.forEach(function (method) {\n  Queue.prototype[method] = function () {\n    var methodResult = Array.prototype[method].apply(this.jobs, arguments)\n    if (this.autostart) {\n      this.start()\n    }\n    return methodResult\n  }\n})\n\nObject.defineProperty(Queue.prototype, 'length', {\n  get: function () {\n    return this.pending + this.jobs.length\n  }\n})\n\nQueue.prototype.start = function (cb) {\n  if (cb) {\n    callOnErrorOrEnd.call(this, cb)\n  }\n\n  this.running = true\n\n  if (this.pending >= this.concurrency) {\n    return\n  }\n\n  if (this.jobs.length === 0) {\n    if (this.pending === 0) {\n      done.call(this)\n    }\n    return\n  }\n\n  var self = this\n  var job = this.jobs.shift()\n  var once = true\n  var session = this.session\n  var timeoutId = null\n  var didTimeout = false\n  var resultIndex = null\n  var timeout = job.hasOwnProperty('timeout') ? job.timeout : this.timeout\n\n  function next (err, result) {\n    if (once && self.session === session) {\n      once = false\n      self.pending--\n      if (timeoutId !== null) {\n        delete self.timers[timeoutId]\n        clearTimeout(timeoutId)\n      }\n\n      if (err) {\n        self.emit('error', err, job)\n      } else if (didTimeout === false) {\n        if (resultIndex !== null) {\n          self.results[resultIndex] = Array.prototype.slice.call(arguments, 1)\n        }\n        self.emit('success', result, job)\n      }\n\n      if (self.session === session) {\n        if (self.pending === 0 && self.jobs.length === 0) {\n          done.call(self)\n        } else if (self.running) {\n          self.start()\n        }\n      }\n    }\n  }\n\n  if (timeout) {\n    timeoutId = setTimeout(function () {\n      didTimeout = true\n      if (self.listeners('timeout').length > 0) {\n        self.emit('timeout', next, job)\n      } else {\n        next()\n      }\n    }, timeout)\n    this.timers[timeoutId] = timeoutId\n  }\n\n  if (this.results) {\n    resultIndex = this.results.length\n    this.results[resultIndex] = null\n  }\n\n  this.pending++\n  self.emit('start', job)\n  var promise = job(next)\n  if (promise && promise.then && typeof promise.then === 'function') {\n    promise.then(function (result) {\n      return next(null, result)\n    }).catch(function (err) {\n      return next(err || true)\n    })\n  }\n\n  if (this.running && this.jobs.length > 0) {\n    this.start()\n  }\n}\n\nQueue.prototype.stop = function () {\n  this.running = false\n}\n\nQueue.prototype.end = function (err) {\n  clearTimers.call(this)\n  this.jobs.length = 0\n  this.pending = 0\n  done.call(this, err)\n}\n\nfunction clearTimers () {\n  for (var key in this.timers) {\n    var timeoutId = this.timers[key]\n    delete this.timers[key]\n    clearTimeout(timeoutId)\n  }\n}\n\nfunction callOnErrorOrEnd (cb) {\n  var self = this\n  this.on('error', onerror)\n  this.on('end', onend)\n\n  function onerror (err) { self.end(err) }\n  function onend (err) {\n    self.removeListener('error', onerror)\n    self.removeListener('end', onend)\n    cb(err, this.results)\n  }\n}\n\nfunction done (err) {\n  this.session++\n  this.running = false\n  this.emit('end', err)\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}